<!DOCTYPE html>
<html>
<head>
    <title>Athena WebSocket Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; }
        .message { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .progress { background: #e3f2fd; }
        .claims { background: #f3e5f5; }
        .result { background: #e8f5e8; }
        .sources { background: #fff3e0; }
        .error { background: #ffebee; }
        button { padding: 10px 20px; margin: 5px; }
        #messages { height: 400px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Athena Real-time Fact Checker Test</h1>
        
        <div>
            <button onclick="connectWebSocket()">Connect WebSocket</button>
            <button onclick="startAnalysis()">Start Analysis</button>
            <button onclick="clearMessages()">Clear Messages</button>
        </div>
        
        <div>
            <h3>Connection Status: <span id="status">Disconnected</span></h3>
            <div>Active Connections: <span id="connections">0</span></div>
        </div>
        
        <div>
            <h3>Messages:</h3>
            <div id="messages"></div>
        </div>
    </div>

    <script>
        let ws = null;
        
        function connectWebSocket() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                console.log('WebSocket already connected');
                return;
            }
            
            ws = new WebSocket('ws://localhost:8000/ws');
            
            ws.onopen = function(event) {
                document.getElementById('status').textContent = 'Connected';
                document.getElementById('status').style.color = 'green';
                addMessage('system', 'WebSocket connected successfully');
            };
            
            ws.onmessage = function(event) {
                const message = JSON.parse(event.data);
                addMessage(message.type, message.data, message.timestamp);
            };
            
            ws.onclose = function(event) {
                document.getElementById('status').textContent = 'Disconnected';
                document.getElementById('status').style.color = 'red';
                addMessage('system', 'WebSocket disconnected');
            };
            
            ws.onerror = function(error) {
                addMessage('error', 'WebSocket error: ' + error);
            };
        }
        
        function addMessage(type, data, timestamp) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ' + type;
            
            const time = timestamp ? new Date(timestamp).toLocaleTimeString() : new Date().toLocaleTimeString();
            messageDiv.innerHTML = `
                <strong>[${time}] ${type.toUpperCase()}</strong><br>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        async function startAnalysis() {
            try {
                const response = await fetch('http://localhost:8000/api/start-analysis', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: "Astronomical studies have indicated that the massive ring system around one of the outer planets is geologically youthful, with evidence pointing to formation only in the last few hundred million years.",
                        pipeline: "fact"
                    })
                });
                
                const result = await response.json();
                addMessage('api', result);
                
            } catch (error) {
                addMessage('error', 'Failed to start analysis: ' + error.message);
            }
        }
        
        function clearMessages() {
            document.getElementById('messages').innerHTML = '';
        }
        
        // Auto-connect on page load
        window.onload = function() {
            connectWebSocket();
        };
    </script>
</body>
</html>
